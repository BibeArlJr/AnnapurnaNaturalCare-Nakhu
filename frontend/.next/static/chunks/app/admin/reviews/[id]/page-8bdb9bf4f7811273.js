(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9851],{14226:function(e,t,a){Promise.resolve().then(a.bind(a,61652))},61652:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var l=a(57437),s=a(2265),n=a(99376),i=a(32617),r=a(94285),o=a(30166);a(98527);let d=(0,o.default)(()=>Promise.all([a.e(3070),a.e(1804)]).then(a.t.bind(a,5600,23)),{loadableGenerated:{webpack:()=>[5600]},ssr:!1});function c(){let e=(0,n.useRouter)(),t=(0,n.useParams)(),a=null==t?void 0:t.id,[o,c]=(0,s.useState)(null),[f,h]=(0,s.useState)(null),[v,g]=(0,s.useState)([]),[b,j]=(0,s.useState)(null),[y,w]=(0,s.useState)(null),[N,P]=(0,s.useState)(!1),[C,R]=(0,s.useState)(""),S=async(e,t)=>(null==e?void 0:e.length)?(await Promise.all(e.map(async e=>{let a=new FormData;a.append("image",e),a.append("folder",t);let l="http://localhost:5000/api".replace(/\/$/,""),s=await fetch("".concat(l,"/api/upload"),{method:"POST",body:a,credentials:"include"});if(!s.ok)throw Error("Upload failed");let n=await s.json();return n.secure_url||n.url}))).filter(Boolean):[];(0,s.useEffect)(()=>{async function e(){try{let e=await (0,i.R1)("/patient-reviews/".concat(a)),t=(null==e?void 0:e.data)||e;c({...t,images:(null==t?void 0:t.images)||[],coverImage:(null==t?void 0:t.coverImage)||"",associatedId:(null==t?void 0:t.associatedId)||"",associatedType:(null==t?void 0:t.associatedType)||"",associatedProgram:(null==t?void 0:t.associatedProgram)||""})}catch(e){R("Failed to load review")}}a&&e()},[a]);let U=e=>{let{name:t,value:a}=e.target;c(e=>({...e,[t]:a}))},_=async t=>{t.preventDefault(),P(!0),R("");try{let t=o.coverImage;if(f){let[e]=await S([f],"patient-reviews");e&&(t=e)}let l=[...o.images||[]];if(v.length){let e=await S(v.map(e=>e.file),"patient-reviews");l=[...l,...e.map(e=>({url:e}))].slice(0,10)}let s=o.videoCoverImage;if(y){let[e]=await S([y],"patient-reviews");e&&(s=e)}let n=o.videoUrl;if(b){let[e]=await S([b],"patient-reviews");e&&(n=e)}await (0,i.nc)("/patient-reviews/".concat(a),{...o,coverImage:t,images:l,videoCoverImage:s,videoUrl:n}),e.push("/admin/reviews")}catch(e){R((null==e?void 0:e.message)||"Failed to save")}finally{P(!1)}};return o?(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)("form",{onSubmit:_,className:"w-full max-w-5xl space-y-5 rounded-2xl border border-slate-800 bg-slate-900/70 p-6 shadow-2xl",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-semibold text-white",children:"Edit Patient Review"}),(0,l.jsx)("p",{className:"text-sm text-slate-400",children:"Update testimonial content."})]}),(0,l.jsx)("button",{type:"button",onClick:()=>e.back(),className:"text-slate-400 hover:text-white text-xl","aria-label":"Close",children:"\xd7"})]}),C?(0,l.jsx)("p",{className:"text-red-400 text-sm",children:C}):null,(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(u,{label:"Patient Name",name:"patientName",value:o.patientName||"",onChange:U,required:!0}),(0,l.jsx)(u,{label:"Country",name:"country",value:o.country||"",onChange:U}),(0,l.jsx)(u,{label:"Headline",name:"headline",value:o.headline||"",onChange:U,required:!0}),(0,l.jsx)(r.Z,{value:{id:o.associatedId,type:o.associatedType},onChange:e=>{c(t=>({...t,associatedId:e.id||"",associatedType:e.type||"",associatedProgram:e.label||(e.id?t.associatedProgram:"")}))},legacyLabel:o.associatedProgram}),(0,l.jsx)(u,{label:"Rating (1-5)",name:"rating",type:"number",min:"1",max:"5",value:o.rating||5,onChange:U}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm text-slate-300",children:"Status"}),(0,l.jsxs)("select",{name:"status",value:o.status||"draft",onChange:U,className:"w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2 text-white text-sm",children:[(0,l.jsx)("option",{value:"draft",children:"Draft"}),(0,l.jsx)("option",{value:"published",children:"Published"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm text-slate-300",children:"Full Review"}),(0,l.jsx)("div",{className:"bg-slate-900/60 border border-slate-700 rounded-xl",children:(0,l.jsx)(d,{theme:"snow",value:o.fullReview||"",onChange:e=>c(t=>({...t,fullReview:e}))})})]}),(0,l.jsxs)("div",{className:"space-y-4 border border-slate-800 rounded-xl p-4 bg-slate-900/60",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base font-semibold text-white",children:"Media"}),(0,l.jsx)("p",{className:"text-xs text-slate-400",children:"Add optional images or video to enhance the testimonial."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)(m,{title:"Cover image",helper:"Single image shown as the hero thumbnail.",children:[(0,l.jsx)(p,{accept:"image/png,image/jpeg,image/webp",onChange:e=>h(e),label:"Click to upload or drop a file"}),(f||o.coverImage)&&(0,l.jsxs)("div",{className:"mt-3 h-32 w-48 rounded-xl overflow-hidden border border-slate-700 relative",children:[(0,l.jsx)("img",{src:f?URL.createObjectURL(f):o.coverImage,className:"w-full h-full object-cover",alt:"Cover"}),(0,l.jsx)("button",{type:"button",className:"absolute top-2 right-2 bg-black/70 text-white text-xs rounded-full px-2 py-0.5",onClick:()=>{h(null),c(e=>({...e,coverImage:""}))},children:"Remove"})]})]}),(0,l.jsxs)(m,{title:"Video testimonial",helper:"Paste a YouTube/Vimeo link or upload an MP4 (max 200MB).",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-xs text-slate-400",children:"Video URL (optional)"}),(0,l.jsx)("input",{name:"videoUrl",value:b?"":o.videoUrl||"",onChange:U,placeholder:"Paste video URL",className:"w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-white text-sm"})]}),(0,l.jsx)(p,{accept:"video/mp4,video/quicktime",onChange:e=>j(e),label:"Upload video file"}),(o.videoUrl||b)&&(0,l.jsx)("div",{className:"mt-2 overflow-hidden rounded-lg border border-slate-700 bg-black",children:(0,l.jsx)("video",{src:b?URL.createObjectURL(b):o.videoUrl,controls:!0,className:"w-full",poster:o.videoCoverImage||void 0})})]}),(0,l.jsxs)(m,{title:"Gallery images",helper:"Upload up to 10 images. Drag to reorder is not required.",children:[(0,l.jsx)(p,{accept:"image/png,image/jpeg,image/webp",multiple:!0,onChange:e=>{var t;let a=Array.from(e.target.files||[]).slice(0,10-(((null===(t=o.images)||void 0===t?void 0:t.length)||0)+v.length)).map(e=>({file:e,preview:URL.createObjectURL(e)}));g(e=>[...e,...a].slice(0,10))},label:"Upload images"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 mt-2",children:[(o.images||[]).map((e,t)=>(0,l.jsx)(x,{src:e.url||e,onRemove:()=>c(e=>({...e,images:(e.images||[]).filter((e,a)=>a!==t)}))},"saved-".concat(t))),v.map((e,t)=>(0,l.jsx)(x,{src:e.preview,onRemove:()=>g(e=>e.filter((e,a)=>a!==t))},e.preview))]}),(0,l.jsx)("p",{className:"text-[11px] text-slate-500",children:"Accepted: JPG/PNG/WEBP. Max 10 images."})]}),(o.videoUrl||b)&&(0,l.jsxs)(m,{title:"Video cover image",helper:"Shown as poster before playing the video.",children:[(0,l.jsx)(p,{accept:"image/png,image/jpeg,image/webp",onChange:e=>w(e),label:"Upload cover image"}),(o.videoCoverImage||y)&&(0,l.jsx)("div",{className:"mt-3 h-32 w-48 rounded-xl overflow-hidden border border-slate-700",children:(0,l.jsx)("img",{src:y?URL.createObjectURL(y):o.videoCoverImage,className:"w-full h-full object-cover",alt:"Video cover"})})]})]})]}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)("button",{type:"submit",disabled:N,className:"px-4 py-2 rounded-lg bg-teal-600 text-white text-sm hover:bg-teal-500 disabled:opacity-50",children:N?"Saving...":"Update review"}),(0,l.jsx)("button",{type:"button",onClick:()=>e.push("/admin/reviews"),className:"px-4 py-2 rounded-lg border border-slate-700 text-sm text-slate-200",children:"Cancel"})]})]})}):(0,l.jsx)("p",{className:"text-slate-400",children:"Loading..."})}function u(e){let{label:t,name:a,value:s,onChange:n,...i}=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm text-slate-300",children:t}),(0,l.jsx)("input",{name:a,value:s,onChange:n,className:"w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2 text-white text-sm",...i})]})}function m(e){let{title:t,helper:a,children:s}=e;return(0,l.jsxs)("div",{className:"space-y-3 rounded-xl border border-slate-800 bg-slate-900/70 p-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-white",children:t}),a?(0,l.jsx)("p",{className:"text-xs text-slate-400",children:a}):null]}),(0,l.jsx)("div",{className:"space-y-2",children:s})]})}function p(e){let{accept:t,multiple:a,onChange:s,label:n}=e;return(0,l.jsxs)("label",{className:"flex flex-col items-center justify-center gap-2 rounded-xl border border-dashed border-slate-700 bg-slate-900/60 p-4 text-slate-300 cursor-pointer hover:border-teal-500 hover:bg-slate-900",children:[(0,l.jsx)("input",{type:"file",accept:t,multiple:a,className:"hidden",onChange:e=>{if(s){if(a)s(e);else{var t;s((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}}}}),(0,l.jsx)("span",{className:"text-xs text-slate-400",children:n}),(0,l.jsx)("span",{className:"text-[11px] text-slate-500",children:t||""})]})}function x(e){let{src:t,onRemove:a}=e;return(0,l.jsxs)("div",{className:"relative h-20 w-20 rounded-lg overflow-hidden border border-slate-700",children:[(0,l.jsx)("img",{src:t,className:"h-full w-full object-cover"}),(0,l.jsx)("button",{type:"button",onClick:a,className:"absolute top-1 right-1 bg-black/70 text-white rounded-full text-xs px-1",children:"\xd7"})]})}},94285:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var l=a(57437),s=a(2265),n=a(32617);let i={retreat:"Retreat",health:"Health"};function r(e,t){let a=i[e]||"Other";return"".concat(a," â€¢ ").concat(t||"Untitled")}function o(e){let{value:t,onChange:a,legacyLabel:i}=e,[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{u(!0);try{let[e,t]=await Promise.all([(0,n.R1)("/retreat-programs"),(0,n.R1)("/packages")]),a=((null==e?void 0:e.data)||e||[]).map(e=>({id:e._id,type:"retreat",title:e.title||e.name||"Untitled"})),l=((null==t?void 0:t.data)||t||[]).map(e=>({id:e._id,type:"health",title:e.name||e.title||"Untitled"}));d([...a,...l])}catch(e){console.error("Association options error:",e)}finally{u(!1)}})()},[]);let m=(0,s.useMemo)(()=>(null==t?void 0:t.id)&&(null==t?void 0:t.type)&&!o.some(e=>e.id===t.id&&e.type===t.type)?[...o,{id:t.id,type:t.type,title:i||t.label||"Selected item"}]:o,[i,o,t]),p=(null==t?void 0:t.id)&&(null==t?void 0:t.type)?"".concat(t.type,":").concat(t.id):"";return(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("label",{className:"text-sm text-slate-300",children:"Associated Program / Package"}),(0,l.jsxs)("select",{value:p,onChange:e=>{let t=e.target.value;if(!t){null==a||a({id:"",type:"",label:""});return}let[l,s]=t.split(":"),n=m.find(e=>e.id===s&&e.type===l);null==a||a({id:s,type:l,label:n?r(n.type,n.title):""})},disabled:c&&0===m.length,className:"w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2 text-white text-sm",children:[(0,l.jsx)("option",{value:"",children:c?"Loading options...":"No association"}),m.map(e=>(0,l.jsx)("option",{value:"".concat(e.type,":").concat(e.id),children:r(e.type,e.title)},"".concat(e.type,"-").concat(e.id)))]}),i&&!p?(0,l.jsxs)("p",{className:"text-xs text-slate-500",children:["Existing association: ",(0,l.jsx)("span",{className:"text-slate-300",children:i})]}):null]})}},32617:function(e,t,a){"use strict";a.d(t,{QW:function(){return d},R1:function(){return i},nc:function(){return c},pE:function(){return o},sg:function(){return r}});let l="http://localhost:5000/api".replace(/\/$/,""),s="".concat(l,"/api");async function n(e){let t=await e.json().catch(()=>({}));if(!e.ok){let a=Error((null==t?void 0:t.message)||"Request failed");throw a.status=e.status,a}return t}async function i(e){return n(await fetch("".concat(s).concat(e),{method:"GET",credentials:"include"}))}async function r(e,t){let a="undefined"!=typeof FormData&&t instanceof FormData;return n(await fetch("".concat(s).concat(e),{method:"POST",credentials:"include",headers:a?void 0:{"Content-Type":"application/json"},body:a?t:JSON.stringify(t||{})}))}async function o(e,t){let a="undefined"!=typeof FormData&&t instanceof FormData;return n(await fetch("".concat(s).concat(e),{method:"PUT",credentials:"include",headers:a?void 0:{"Content-Type":"application/json"},body:a?t:JSON.stringify(t||{})}))}async function d(e){return n(await fetch("".concat(s).concat(e),{method:"DELETE",credentials:"include"}))}async function c(e,t){return n(await fetch("".concat(s).concat(e),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t||{})}))}},30166:function(e,t,a){"use strict";a.d(t,{default:function(){return s.a}});var l=a(55775),s=a.n(l)},99376:function(e,t,a){"use strict";var l=a(35475);a.o(l,"useParams")&&a.d(t,{useParams:function(){return l.useParams}}),a.o(l,"usePathname")&&a.d(t,{usePathname:function(){return l.usePathname}}),a.o(l,"useRouter")&&a.d(t,{useRouter:function(){return l.useRouter}}),a.o(l,"useSearchParams")&&a.d(t,{useSearchParams:function(){return l.useSearchParams}})},55775:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let l=a(60917);a(57437),a(2265);let s=l._(a(15602));function n(e,t){var a;let l={loading:e=>{let{error:t,isLoading:a,pastDelay:l}=e;return null}};"function"==typeof e&&(l.loader=e);let n={...l,...t};return(0,s.default)({...n,modules:null==(a=n.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},81523:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let l=a(18993);function s(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new l.BailoutToCSRError(t);return a}},15602:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let l=a(57437),s=a(2265),n=a(81523),i=a(70049);function r(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(r(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},a=(0,s.lazy)(()=>t.loader().then(r)),d=t.loading;function c(e){let r=d?(0,l.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=t.ssr?(0,l.jsxs)(l.Fragment,{children:["undefined"==typeof window?(0,l.jsx)(i.PreloadCss,{moduleIds:t.modules}):null,(0,l.jsx)(a,{...e})]}):(0,l.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(a,{...e})});return(0,l.jsx)(s.Suspense,{fallback:r,children:o})}return c.displayName="LoadableComponent",c}},70049:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return n}});let l=a(57437),s=a(20544);function n(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=(0,s.getExpectedRequestStore)("next/dynamic css"),n=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files.filter(e=>e.endsWith(".css"));n.push(...t)}}return 0===n.length?null:(0,l.jsx)(l.Fragment,{children:n.map(e=>(0,l.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:a.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},98527:function(){}},function(e){e.O(0,[6458,2971,2117,1744],function(){return e(e.s=14226)}),_N_E=e.O()}]);