(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8504],{69024:function(e,t,a){Promise.resolve().then(a.bind(a,70712))},70712:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(57437),l=a(2265),n=a(99376),r=a(30166),i=a(32617);a(98527);let o=(0,r.default)(()=>Promise.all([a.e(3070),a.e(1804)]).then(a.t.bind(a,5600,23)),{loadableGenerated:{webpack:()=>[5600]},ssr:!1}),d="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-teal-500";function c(e){var t,a;let{params:r}=e,c=(0,n.useRouter)(),u=(0,l.useRef)(null),m=(0,l.useRef)(null),p=(0,l.useRef)(null),[f,x]=(0,l.useState)(!0),[h,g]=(0,l.useState)(""),[v,b]=(0,l.useState)(!1),[j,y]=(0,l.useState)(""),[N,w]=(0,l.useState)(""),[P,C]=(0,l.useState)(""),[k,S]=(0,l.useState)([]),[R,I]=(0,l.useState)([]),[D,_]=(0,l.useState)(""),[O,A]=(0,l.useState)({name:"",tagline:"",description:"",isActive:!0,image:"",heroImage:"",coverImage:"",images:[],videos:[]});async function E(){x(!0),g("");try{var e;let t=await (0,i.R1)("/departments/".concat(r.id,"?includeDrafts=true")),a=(null==t?void 0:t.data)||t||{};A({name:a.name||"",tagline:a.tagline||"",description:a.description||"",isActive:null===(e=a.isActive)||void 0===e||e,image:a.image||a.heroImage||a.coverImage||"",heroImage:a.heroImage||a.image||a.coverImage||"",coverImage:a.coverImage||a.heroImage||a.image||"",images:a.images||[],videos:a.videos||[]}),y(a.coverImage||a.image||a.heroImage||"")}catch(e){g("Department not found")}finally{x(!1)}}function T(e){let{name:t,value:a}=e.target;A(e=>({...e,[t]:a}))}function U(e){if(!e)return;let t=new FileReader;t.onloadend=()=>{w(t.result.toString()),y(t.result.toString()),C(e.name)},t.readAsDataURL(e)}async function F(e){e.preventDefault(),b(!0);try{let e=async(e,t)=>(null==e?void 0:e.length)?(await Promise.all(e.map(async e=>{let a=new FormData;a.append("image",e),t&&a.append("folder",t);let s=await fetch((0,i.f8)("/upload"),{method:"POST",body:a,credentials:"include"});if(!s.ok)throw Error("Upload failed");let l=await s.json();return l.secure_url||l.url}))).filter(Boolean):[],t=O.coverImage||O.image||O.heroImage;N&&(t=void 0);let a=[...O.images||[]];if(k.length){let t=await e(k.map(e=>e.file),"departments");a=[...a,...t].slice(0,10)}let s=[...O.videos||[]],l=D.split(/\n|,/).map(e=>e.trim()).filter(Boolean);if(s=[...s,...l],R.length){let t=await e(R.map(e=>e.file),"departments");s=[...s,...t]}let n={...O,imageData:N||void 0,heroImage:O.heroImage||O.image||t,image:O.image||t,coverImage:O.coverImage||t,images:a,videos:s};await (0,i.pE)("/departments/".concat(r.id),n),c.push("/admin/departments")}catch(e){g(e.message||"Failed to update department")}finally{b(!1)}}return(0,l.useEffect)(()=>{E()},[null==r?void 0:r.id]),(0,s.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 px-4",children:(0,s.jsxs)("div",{className:"relative w-full max-w-4xl max-h-[90vh] bg-[#0f131a] border border-white/10 rounded-2xl shadow-2xl flex flex-col overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>c.push("/admin/departments"),className:"absolute top-4 right-4 text-gray-300 hover:text-white bg-slate-700/40 hover:bg-slate-700 rounded-full p-2 transition",children:"✕"}),(0,s.jsxs)("div",{className:"px-6 pt-6 pb-3 border-b border-slate-800",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Edit Department"}),(0,s.jsx)("p",{className:"text-sm text-slate-400",children:"Update department details and image."})]}),(0,s.jsxs)("form",{onSubmit:F,className:"flex-1 overflow-y-auto px-6 pb-6 pt-4 space-y-6",children:[h&&(0,s.jsx)("div",{className:"rounded-lg border border-rose-500/40 bg-rose-900/20 text-rose-200 px-4 py-3 text-sm",children:h}),f?(0,s.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,s.jsx)("div",{className:"h-10 bg-slate-800 rounded-lg"}),(0,s.jsx)("div",{className:"h-24 bg-slate-800 rounded-lg"}),(0,s.jsx)("div",{className:"h-40 bg-slate-800 rounded-lg"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm text-slate-300",children:"Department Name"}),(0,s.jsx)("input",{name:"name",required:!0,value:O.name,onChange:T,className:d,placeholder:"e.g. Physiotherapy"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm text-slate-300",children:"Short Tagline (optional)"}),(0,s.jsx)("input",{name:"tagline",value:O.tagline,onChange:T,className:d,placeholder:"e.g. Restore your mobility"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"text-sm text-slate-300",children:"Description"}),(0,s.jsx)(o,{theme:"snow",value:O.description,onChange:e=>A(t=>({...t,description:e})),placeholder:"Write detailed department description...",modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link"],["clean"]]}})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Upload Image"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Drag & drop or click to choose a cover image."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-xs text-slate-400",children:"Status"}),(0,s.jsxs)("button",{type:"button",onClick:function(){A(e=>({...e,isActive:!e.isActive}))},className:"relative inline-flex h-9 w-16 items-center rounded-full border transition ".concat(O.isActive?"bg-teal-600 border-teal-500":"bg-slate-700 border-slate-600"),children:[(0,s.jsx)("span",{className:"inline-block h-7 w-7 transform rounded-full bg-white shadow transition ".concat(O.isActive?"translate-x-7":"translate-x-1")}),(0,s.jsx)("span",{className:"absolute left-2 text-[11px] text-slate-900 font-semibold",children:O.isActive?"On":""}),(0,s.jsx)("span",{className:"absolute right-2 text-[11px] text-slate-200 font-semibold",children:O.isActive?"":"Off"})]})]})]}),(0,s.jsxs)("div",{className:"border-2 border-dashed border-slate-700 bg-slate-900/40 rounded-xl p-4 flex flex-col gap-3 items-center justify-center text-slate-300 cursor-pointer hover:border-teal-500 transition",onDragOver:e=>e.preventDefault(),onDrop:function(e){var t;e.preventDefault();let a=null===(t=e.dataTransfer.files)||void 0===t?void 0:t[0];a&&U(a)},onClick:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.click()},children:[(0,s.jsx)("input",{type:"file",accept:"image/*",ref:u,className:"hidden",onChange:function(e){var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&U(a)}}),(0,s.jsxs)("div",{className:"text-center space-y-1",children:[(0,s.jsx)("p",{className:"font-medium",children:"Drop an image here or click to upload"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Recommended: landscape, under 5MB. JPG or PNG."})]}),P&&(0,s.jsxs)("p",{className:"text-xs text-teal-300",children:["Selected: ",P]}),j&&(0,s.jsxs)("div",{className:"w-full grid grid-cols-1 md:grid-cols-[200px_1fr] gap-4 items-center",children:[(0,s.jsx)("img",{src:j,alt:"Preview",className:"w-full max-w-[200px] h-32 object-cover rounded-lg border border-slate-700"}),(0,s.jsx)("p",{className:"text-sm text-slate-400",children:"This preview will be uploaded to Cloudinary and saved with the department."})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Gallery Images"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Add supporting visuals (up to 10)."})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=m.current)||void 0===e?void 0:e.click()},className:"px-3 py-1.5 text-xs rounded-lg border border-slate-700 text-slate-100 hover:bg-slate-800",children:"Add images"})]}),(0,s.jsx)("input",{ref:m,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:function(e){var t;let a=Array.from(e.target.files||[]).slice(0,10-(((null===(t=O.images)||void 0===t?void 0:t.length)||0)+k.length)).map(e=>({file:e,preview:URL.createObjectURL(e),name:e.name}));S(e=>[...e,...a])}}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[k.map((e,t)=>(0,s.jsxs)("div",{className:"relative rounded-lg overflow-hidden border border-slate-700 bg-slate-900",children:[(0,s.jsx)("img",{src:e.preview,alt:e.name,className:"h-28 w-full object-cover"}),(0,s.jsx)("button",{type:"button",onClick:()=>{S(e=>e.filter((e,a)=>a!==t))},className:"absolute top-1 right-1 rounded-full bg-black/60 text-white text-xs px-2 py-1",children:"✕"})]},"".concat(e.name,"-").concat(t))),(O.images||[]).map((e,t)=>(0,s.jsx)("div",{className:"relative rounded-lg overflow-hidden border border-slate-700 bg-slate-900",children:(0,s.jsx)("img",{src:e,alt:"Image ".concat(t+1),className:"h-28 w-full object-cover"})},"saved-".concat(t)))]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-slate-300",children:"Videos (optional)"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Upload files or paste URLs (one per line)."})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},className:"px-3 py-1.5 text-xs rounded-lg border border-slate-700 text-slate-100 hover:bg-slate-800",children:"Upload videos"})]}),(0,s.jsx)("textarea",{value:D,onChange:e=>_(e.target.value),placeholder:"Paste video URLs – one per line",className:d,rows:3}),(0,s.jsx)("input",{ref:p,type:"file",accept:"video/*",multiple:!0,className:"hidden",onChange:function(e){let t=Array.from(e.target.files||[]).map(e=>({file:e,name:e.name}));I(e=>[...e,...t])}}),(R.length>0||(null===(t=O.videos)||void 0===t?void 0:t.length))&&(0,s.jsxs)("div",{className:"space-y-2",children:[R.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-slate-300",children:[(0,s.jsx)("span",{children:e.name}),(0,s.jsx)("button",{type:"button",onClick:()=>I(e=>e.filter((e,a)=>a!==t)),className:"text-rose-300 hover:text-rose-200",children:"Remove"})]},"".concat(e.name,"-").concat(t))),null===(a=O.videos)||void 0===a?void 0:a.map((e,t)=>(0,s.jsx)("div",{className:"text-xs text-slate-400",children:e},"existing-".concat(t)))]})]})]})]}),(0,s.jsxs)("div",{className:"mt-auto border-t border-slate-800 bg-[#0b1017] px-6 py-4 flex justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>c.push("/admin/departments"),className:"px-4 py-2 rounded-lg bg-slate-800 text-white hover:bg-slate-700 transition",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",onClick:F,disabled:v||f,className:"px-4 py-2 rounded-lg bg-teal-600 text-white hover:bg-teal-500 transition disabled:opacity-70",children:v?"Updating...":"Update"})]})]})})}},32617:function(e,t,a){"use strict";a.d(t,{QW:function(){return c},R1:function(){return i},f8:function(){return n},nc:function(){return u},pE:function(){return d},sg:function(){return o}});let s="http://localhost:5000/api".replace(/\/$/,""),l=s.endsWith("/api")?s:"".concat(s,"/api");function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.startsWith("/")?e:"/".concat(e),a="".concat(l).concat(t);return console.log("[api] request url:",a),a}async function r(e){let t=await e.json().catch(()=>({}));if(!e.ok){let a=Error((null==t?void 0:t.message)||"Request failed");throw a.status=e.status,a}return t}async function i(e){return r(await fetch(n(e),{method:"GET",credentials:"include"}))}async function o(e,t){let a="undefined"!=typeof FormData&&t instanceof FormData;return r(await fetch(n(e),{method:"POST",credentials:"include",headers:a?void 0:{"Content-Type":"application/json"},body:a?t:JSON.stringify(t||{})}))}async function d(e,t){let a="undefined"!=typeof FormData&&t instanceof FormData;return r(await fetch(n(e),{method:"PUT",credentials:"include",headers:a?void 0:{"Content-Type":"application/json"},body:a?t:JSON.stringify(t||{})}))}async function c(e){return r(await fetch(n(e),{method:"DELETE",credentials:"include"}))}async function u(e,t){return r(await fetch(n(e),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t||{})}))}},30166:function(e,t,a){"use strict";a.d(t,{default:function(){return l.a}});var s=a(55775),l=a.n(s)},99376:function(e,t,a){"use strict";var s=a(35475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},55775:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n}});let s=a(60917);a(57437),a(2265);let l=s._(a(15602));function n(e,t){var a;let s={loading:e=>{let{error:t,isLoading:a,pastDelay:s}=e;return null}};"function"==typeof e&&(s.loader=e);let n={...s,...t};return(0,l.default)({...n,modules:null==(a=n.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},81523:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return l}});let s=a(18993);function l(e){let{reason:t,children:a}=e;if("undefined"==typeof window)throw new s.BailoutToCSRError(t);return a}},15602:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return d}});let s=a(57437),l=a(2265),n=a(81523),r=a(70049);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},a=(0,l.lazy)(()=>t.loader().then(i)),d=t.loading;function c(e){let i=d?(0,s.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=t.ssr?(0,s.jsxs)(s.Fragment,{children:["undefined"==typeof window?(0,s.jsx)(r.PreloadCss,{moduleIds:t.modules}):null,(0,s.jsx)(a,{...e})]}):(0,s.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(a,{...e})});return(0,s.jsx)(l.Suspense,{fallback:i,children:o})}return c.displayName="LoadableComponent",c}},70049:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return n}});let s=a(57437),l=a(20544);function n(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let a=(0,l.getExpectedRequestStore)("next/dynamic css"),n=[];if(a.reactLoadableManifest&&t){let e=a.reactLoadableManifest;for(let a of t){if(!e[a])continue;let t=e[a].files.filter(e=>e.endsWith(".css"));n.push(...t)}}return 0===n.length?null:(0,s.jsx)(s.Fragment,{children:n.map(e=>(0,s.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:a.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},98527:function(){}},function(e){e.O(0,[6458,2971,2117,1744],function(){return e(e.s=69024)}),_N_E=e.O()}]);