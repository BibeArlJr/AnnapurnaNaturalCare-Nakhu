"use strict";exports.id=4998,exports.ids=[4998],exports.modules={24998:(e,t,a)=>{a.d(t,{Z:()=>d});var r=a(10326),s=a(17577),l=a(89420),o=a(6168);let i="w-full rounded-xl border px-4 py-3 text-sm focus:outline-none transition",n={fullName:"",email:"",phone:"",country:"",preferredStartDate:"",numberOfPeople:1,additionalNotes:""};function d({program:e,open:t,onClose:a}){let[d,c]=(0,s.useState)(n),[m,p]=(0,s.useState)({}),[x,h]=(0,s.useState)(!1),[u,f]=(0,s.useState)(!1),[b,g]=(0,s.useState)(null),[N,j]=(0,s.useState)([]),[y,v]=(0,s.useState)(""),[P,$]=(0,s.useState)(""),[w,S]=(0,s.useState)("hospital_premium"),D=(0,s.useMemo)(()=>e?.durationDays||e?.duration||1,[e?.duration,e?.durationDays]),_=e?.accommodation?.hospitalPremiumPrice||(e?.accommodationPricing||[]).find(e=>"hospital_premium"===e.key)?.pricePerPersonUSD||0,C=(0,s.useMemo)(()=>e?.pricePerPersonUSD?`$${e.pricePerPersonUSD} per person`:"Contact for pricing",[e]),k=e?.pricePerPersonUSD?Number(e.pricePerPersonUSD):null,O=k?k*(Number(d.numberOfPeople)||1):null,F=(0,s.useMemo)(()=>Array.from(new Set(N.map(e=>e.location).filter(Boolean))),[N]),A=(0,s.useMemo)(()=>Array.from(new Set(N.map(e=>e.starRating).filter(Boolean))).sort(),[N]),R=(0,s.useMemo)(()=>{if("partner_hotel"!==w)return null;let e=N.filter(e=>(!y||e.location===y)&&(!P||Number(e.starRating)===Number(P)));return e.length?e.reduce((e,t)=>Number(t.pricePerNight||0)<Number(e.pricePerNight||0)?t:e):null},[w,N,y,P]),U=R&&Number(R.pricePerNight)||0,T=U*(D||1)*(Number(d.numberOfPeople)||1),M=(Number(_)||0)*(D||1)*(Number(d.numberOfPeople)||1),q="partner_hotel"===w?T:"hospital_premium"===w?M:0,B=null!==O?O+q:null,H="partner_hotel"===w&&!!y&&!!P&&!R,I="hospital_premium"===w?"Hospital premium stay":"partner_hotel"===w?R?`${R.location}${R.starRating?` \xb7 ${R.starRating}★`:""}`:"Partner hotel":"Own arrangement";if(!t||!e)return null;let E=e=>{p(t=>{if(!t[e])return t;let a={...t};return delete a[e],a})},z=()=>{let e={};d.fullName.trim()||(e.fullName="Full name is required"),d.email.trim()?/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(d.email.trim())||(e.email="Enter a valid email"):e.email="Email is required";let t=d.phone.replace(/\D/g,"");if((!t||t.length<7)&&(e.phone="Phone must be at least 7 digits"),d.country.trim()||(e.country="Country is required"),d.preferredStartDate){let t=new Date(d.preferredStartDate),a=new Date;a.setHours(0,0,0,0),(isNaN(t.getTime())||t<a)&&(e.preferredStartDate="Choose today or a future date")}else e.preferredStartDate="Preferred start date is required";let a=Number(d.numberOfPeople);return(!a||a<1)&&(e.numberOfPeople="At least 1 person required"),"partner_hotel"!==w||(y?P?R||(e.accommodation="No partner hotel matches this selection"):e.accommodation="Choose a hotel quality":e.accommodation="Choose a location"),p(e),0===Object.keys(e).length},L=e=>{let{name:t,value:a}=e.target,r=a;"numberOfPeople"===t&&(r=Math.max(1,Number(a)||1)),E(t),c(e=>({...e,[t]:r}))},V=()=>{p({}),c(n),f(!1),g(null),v(""),$(""),S("hospital_premium"),a?.()},G=async t=>{if(t?.preventDefault(),z()){E("accommodation"),h(!0);try{let t="http://localhost:5000/api".replace(/\/$/,""),a=await fetch(`${t}/api/retreat-bookings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({programId:e._id,programTitle:e.title,fullName:d.fullName,email:d.email,phone:d.phone,country:d.country,preferredStartDate:d.preferredStartDate,numberOfPeople:Number(d.numberOfPeople)||1,additionalNotes:d.additionalNotes,accommodationChoice:w,hotelMode:"partner_hotel"===w?"locationAndStar":"none",hotelLocation:"partner_hotel"===w?R?.location:void 0,hotelStarRating:"partner_hotel"===w?R?.starRating:void 0,partnerHotelId:"partner_hotel"===w?R?._id:void 0,accommodationMode:"partner_hotel"===w?"locationAndStar":w,accommodationSelected:"own_arrangement"!==w,accommodationPricePerNight:"partner_hotel"===w?U:_,accommodationNights:D||1,accommodationTotalCost:q,totalPriceUSD:B||void 0}),credentials:"include"}),r=await a.json().catch(()=>({}));if(!a.ok)throw Error((0,o.i)({data:r},"Failed to book retreat"));g(r?.data?._id||r?.bookingId||null),p({}),f(!0)}catch(e){alert(e.message||"Failed to submit booking")}finally{h(!1)}}},J=async()=>{if(b)try{let e=await (0,l.sg)("/payments/stripe/checkout",{bookingId:b,type:"retreat"});e?.url&&(window.location.href=e.url)}catch(e){alert((0,o.i)(e,"Unable to start Stripe checkout"))}},Z=e=>m[e]?`${i} border-red-400 focus:border-red-500 focus:ring-2 focus:ring-red-200 bg-white`:`${i} border-[#dfe8e2] focus:border-[#2F8D59] focus:ring-2 focus:ring-[#cfe8d6] bg-white`,K=(0,r.jsxs)("div",{className:"space-y-2 text-sm text-[#10231a]",children:[(0,r.jsxs)("div",{className:"rounded-lg bg-[#fff7ed] border border-[#f2d5b1] px-3 py-2",children:[r.jsx("p",{className:"font-semibold text-[#c2410c]",children:"Important"}),r.jsx("p",{children:"Extra charges apply for any activities or services not listed in the program description."})]}),(0,r.jsxs)("div",{className:"rounded-lg bg-[#fef2f2] border border-[#fecdd3] px-3 py-2",children:[r.jsx("p",{className:"font-semibold text-[#be123c]",children:"Refund Policy"}),r.jsx("p",{children:"After payment, booking cancellations will incur a 10% deduction of the total booking cost."})]})]});return r.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-start justify-center px-4 py-10",onClick:V,children:(0,r.jsxs)("div",{className:"w-full max-w-3xl max-h-[90vh] bg-white rounded-2xl shadow-2xl border border-[#dfe8e2] p-6 md:p-8 space-y-6 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-[#2F8D59] font-semibold",children:"Book this retreat program"}),r.jsx("h3",{className:"text-xl font-semibold text-[#10231a]",children:e.title}),(0,r.jsxs)("div",{className:"text-sm text-[#4c5f68] space-y-0.5",children:[(0,r.jsxs)("p",{children:["Type: ","inside_valley"===e.programType?"Inside Valley":"Outside Valley"]}),e.durationDays?(0,r.jsxs)("p",{children:["Duration: ",e.durationDays," days"]}):null,(0,r.jsxs)("p",{children:["Price: ",C]})]})]}),r.jsx("button",{onClick:V,className:"text-sm text-[#2F8D59] font-semibold","aria-label":"Close booking",children:"✕"})]}),u?(0,r.jsxs)("div",{className:"space-y-4 border-t border-[#e6f0eb] pt-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[r.jsx("p",{className:"text-[#4c5f68]",children:"Retreat price / person"}),r.jsx("p",{className:"font-semibold text-[#10231a]",children:k?`$${k}`:"—"})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[r.jsx("p",{className:"text-[#4c5f68]",children:"Accommodation"}),r.jsx("p",{className:"font-semibold text-[#10231a]",children:"hospital_premium"===w?_?`$${_} / night`:"Hospital premium":"partner_hotel"===w?R?`$${R.pricePerNight} / night`:"Partner hotel":"Own arrangement"})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[r.jsx("p",{className:"text-[#4c5f68]",children:"Number of people"}),r.jsx("p",{className:"font-semibold text-[#10231a]",children:d.numberOfPeople})]}),(0,r.jsxs)("div",{className:"rounded-xl border-2 border-[#2F8D59] bg-[#e6f2ea] px-4 py-3",children:[r.jsx("p",{className:"text-[#2F8D59] font-semibold",children:"Total amount"}),r.jsx("p",{className:"text-lg font-bold text-[#10231a]",children:null!==B?`$${B}`:"—"})]})]}),(0,r.jsxs)("div",{className:"text-sm text-[#10231a] bg-white border border-[#dfe8e2] rounded-xl px-4 py-3 space-y-1",children:[(0,r.jsxs)("p",{children:["Base program cost: ",null!==O?`$${O}`:"—"]}),(0,r.jsxs)("p",{children:["Accommodation (",I,"): ",q?`$${q}`:"No extra cost"]}),(0,r.jsxs)("p",{className:"font-semibold",children:["Grand total: ",null!==B?`$${B}`:"—"]})]}),"partner_hotel"===w&&R&&(0,r.jsxs)("div",{className:"text-sm text-[#10231a] bg-[#f5f8f4] border border-[#dfe8e2] rounded-xl px-4 py-3",children:[r.jsx("p",{className:"font-semibold text-[#2F8D59]",children:"Partner hotel"}),(0,r.jsxs)("p",{children:[R.location," ",R.starRating?`\xb7 ${R.starRating}★`:""," — $",R.pricePerNight,"/night \xd7 ",D," night",1===D?"":"s"," = $",q]})]}),"hospital_premium"===w&&(0,r.jsxs)("div",{className:"text-sm text-[#10231a] bg-[#f5f8f4] border border-[#dfe8e2] rounded-xl px-4 py-3",children:[r.jsx("p",{className:"font-semibold text-[#2F8D59]",children:"Hospital premium"}),(0,r.jsxs)("p",{children:["$",_||0," / night \xd7 ",D," night",1===D?"":"s"," \xd7 ",d.numberOfPeople," people = $",M]})]}),K,(0,r.jsxs)("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-sm font-semibold text-[#10231a]",children:"Choose how you want to pay"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[r.jsx("button",{onClick:J,className:"flex-1 inline-flex justify-center items-center rounded-full bg-[#2F8D59] text-white text-sm font-semibold px-4 py-3 hover:bg-[#27784c] transition",children:"Pay now with Stripe"}),r.jsx("button",{onClick:()=>{alert("Booking placed successfully. Pay later to confirm."),V()},className:"flex-1 inline-flex justify-center items-center rounded-full border border-[#dfe8e2] text-[#10231a] text-sm font-semibold px-4 py-3 hover:bg-[#f5f8f4] transition",children:"Pay later"})]})]})]}):(0,r.jsxs)("form",{className:"space-y-4",onSubmit:G,children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Full Name *"}),r.jsx("input",{name:"fullName",value:d.fullName,onChange:L,className:Z("fullName")}),m.fullName&&r.jsx("p",{className:"text-xs text-red-500",children:m.fullName})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Email *"}),r.jsx("input",{name:"email",type:"email",value:d.email,onChange:L,className:Z("email")}),m.email&&r.jsx("p",{className:"text-xs text-red-500",children:m.email})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Phone *"}),r.jsx("input",{name:"phone",value:d.phone,onChange:L,className:Z("phone")}),m.phone&&r.jsx("p",{className:"text-xs text-red-500",children:m.phone})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Country *"}),r.jsx("input",{name:"country",value:d.country,onChange:L,className:Z("country")}),m.country&&r.jsx("p",{className:"text-xs text-red-500",children:m.country})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Preferred Start Date *"}),r.jsx("input",{type:"date",name:"preferredStartDate",value:d.preferredStartDate,onChange:L,className:Z("preferredStartDate")}),m.preferredStartDate&&r.jsx("p",{className:"text-xs text-red-500",children:m.preferredStartDate})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Number of People *"}),r.jsx("input",{type:"number",min:1,name:"numberOfPeople",value:d.numberOfPeople,onChange:L,className:Z("numberOfPeople")}),m.numberOfPeople&&r.jsx("p",{className:"text-xs text-red-500",children:m.numberOfPeople})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[r.jsx("p",{className:"text-sm text-[#10231a] font-semibold",children:"Accommodation choice"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"flex items-start gap-3 rounded-xl border border-[#dfe8e2] px-4 py-3 bg-white cursor-pointer",children:[r.jsx("input",{type:"radio",name:"accommodationChoice",value:"hospital_premium",checked:"hospital_premium"===w,onChange:()=>{S("hospital_premium"),v(""),$(""),E("accommodation")},className:"mt-1"}),(0,r.jsxs)("div",{className:"text-sm text-[#10231a]",children:[r.jsx("p",{className:"font-semibold",children:"Hospital premium stay"}),r.jsx("p",{className:"text-[#4c5f68]",children:_?`$${_} / night \xd7 ${D} night${1===D?"":"s"}`:"Price not set"})]})]}),(0,r.jsxs)("label",{className:"flex items-start gap-3 rounded-xl border border-[#dfe8e2] px-4 py-3 bg-white cursor-pointer",children:[r.jsx("input",{type:"radio",name:"accommodationChoice",value:"partner_hotel",checked:"partner_hotel"===w,onChange:()=>{S("partner_hotel"),E("accommodation")},className:"mt-1"}),(0,r.jsxs)("div",{className:"text-sm text-[#10231a]",children:[r.jsx("p",{className:"font-semibold",children:"Partner hotel accommodation"}),r.jsx("p",{className:"text-[#4c5f68]",children:R?`USD ${R.pricePerNight} / night \xd7 ${D} night${1===D?"":"s"} = USD ${T}`:"Choose a partner hotel option"})]})]}),(0,r.jsxs)("label",{className:"flex items-start gap-3 rounded-xl border border-[#dfe8e2] px-4 py-3 bg-white cursor-pointer",children:[r.jsx("input",{type:"radio",name:"accommodationChoice",value:"own_arrangement",checked:"own_arrangement"===w,onChange:()=>{S("own_arrangement"),v(""),$(""),E("accommodation")},className:"mt-1"}),(0,r.jsxs)("div",{className:"text-sm text-[#10231a]",children:[r.jsx("p",{className:"font-semibold",children:"Own arrangement"}),r.jsx("p",{className:"text-[#4c5f68]",children:"No additional accommodation charges."})]})]})]}),"partner_hotel"!==w?null:(0,r.jsxs)("div",{className:"space-y-3 border border-[#dfe8e2] rounded-xl p-4 bg-[#f9fcf8]",children:[0===N.length?r.jsx("div",{className:"text-sm text-[#4c5f68] bg-white border border-[#dfe8e2] rounded-lg px-3 py-2",children:"No partner hotels available right now."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-semibold text-[#10231a]",children:"Location"}),(0,r.jsxs)("select",{value:y,onChange:e=>{E("accommodation"),v(e.target.value)},className:`${i} bg-white ${H?"border-red-400 focus:border-red-500 focus:ring-red-200":"border-[#dfe8e2]"}`,children:[r.jsx("option",{value:"",children:"Choose location"}),F.map(e=>r.jsx("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-semibold text-[#10231a]",children:"Hotel quality"}),(0,r.jsxs)("select",{value:P,onChange:e=>{E("accommodation"),$(e.target.value)},className:`${i} bg-white ${H?"border-red-400 focus:border-red-500 focus:ring-red-200":"border-[#dfe8e2]"}`,children:[r.jsx("option",{value:"",children:"Choose rating"}),A.map(e=>(0,r.jsxs)("option",{value:e,children:[e," ★"]},e))]})]})]}),r.jsx("div",{className:"text-sm text-[#10231a] bg-white border border-[#dfe8e2] rounded-lg px-3 py-2 space-y-1",children:R?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["Price per night: ",(0,r.jsxs)("span",{className:"font-semibold",children:["USD ",R.pricePerNight]})]}),(0,r.jsxs)("p",{children:["Nights: ",D," • Total: ",(0,r.jsxs)("span",{className:"font-semibold",children:["USD ",T]})]})]}):H?r.jsx("p",{className:"text-red-600",children:"No partner hotel found for the selected location and hotel category. Please choose another option."}):r.jsx("p",{className:"text-[#4c5f68]",children:"Select location and hotel quality to see pricing."})})]}),m.accommodation&&r.jsx("p",{className:"text-xs text-red-500",children:m.accommodation})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[r.jsx("p",{className:"text-[#4c5f68]",children:"Retreat price / person"}),r.jsx("p",{className:"font-semibold text-[#10231a]",children:k?`$${k}`:"—"})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[r.jsx("p",{className:"text-[#4c5f68]",children:"Accommodation"}),r.jsx("p",{className:"font-semibold text-[#10231a]",children:"hospital_premium"===w?_?`$${_} / night`:"Hospital premium":"partner_hotel"===w?R?`$${R.pricePerNight} / night`:"Partner hotel":"Own arrangement"})]}),(0,r.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[r.jsx("p",{className:"text-[#4c5f68]",children:"Duration"}),(0,r.jsxs)("p",{className:"font-semibold text-[#10231a]",children:[D," night",1===D?"":"s"]})]}),(0,r.jsxs)("div",{className:"rounded-xl border-2 border-[#2F8D59] bg-[#e6f2ea] px-4 py-3",children:[r.jsx("p",{className:"text-[#2F8D59] font-semibold",children:"Total amount"}),r.jsx("p",{className:"text-lg font-bold text-[#10231a]",children:null!==B?`$${B}`:"—"})]})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Additional Notes"}),r.jsx("textarea",{name:"additionalNotes",rows:3,value:d.additionalNotes,onChange:L,className:`${i} border-[#dfe8e2] focus:border-[#2F8D59] focus:ring-2 focus:ring-[#cfe8d6] bg-white resize-none`,placeholder:"Share any preferences or needs"})]}),K,(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[r.jsx("button",{type:"button",onClick:V,className:"px-4 py-2 rounded-full border border-[#dfe8e2] text-[#10231a] hover:bg-[#f5f8f4] transition",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:x||H,className:"px-5 py-2 rounded-full bg-[#2F8D59] text-white text-sm font-semibold hover:bg-[#27784c] transition disabled:opacity-60",children:x?"Booking...":"Book Retreat"})]})]})]})})}},6168:(e,t,a)=>{a.d(t,{i:()=>r});function r(e,t="Something went wrong"){if(!e)return t;let a=e.response?.data||e.data;if(a?.errors&&"object"==typeof a.errors){let e=Object.values(a.errors).flatMap(e=>Array.isArray(e?._errors)?e._errors:[]).filter(Boolean);if(e.length)return e.join(", ")}return a?.message?a.message:"string"==typeof e?e:e.message?e.message:t}}};