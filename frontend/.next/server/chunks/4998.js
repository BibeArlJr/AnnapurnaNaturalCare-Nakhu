"use strict";exports.id=4998,exports.ids=[4998],exports.modules={24998:(e,t,r)=>{r.d(t,{Z:()=>d});var a=r(10326),s=r(17577),l=r(89420),o=r(6168);let i="w-full rounded-xl border px-4 py-3 text-sm focus:outline-none transition",n={fullName:"",email:"",phone:"",country:"",preferredStartDate:"",numberOfPeople:1,additionalNotes:""};function d({program:e,open:t,onClose:r}){let[d,c]=(0,s.useState)(n),[m,p]=(0,s.useState)({}),[x,h]=(0,s.useState)(!1),[u,f]=(0,s.useState)(!1),[b,g]=(0,s.useState)(null),[N,j]=(0,s.useState)([]),[y,v]=(0,s.useState)(""),[P,w]=(0,s.useState)(""),[$,S]=(0,s.useState)("hospital_premium"),D=(0,s.useMemo)(()=>e?.durationDays||e?.duration||1,[e?.duration,e?.durationDays]),_=e?.accommodation?.hospitalPremiumPrice||(e?.accommodationPricing||[]).find(e=>"hospital_premium"===e.key)?.pricePerPersonUSD||0,C=(0,s.useMemo)(()=>e?.pricePerPersonUSD?`$${e.pricePerPersonUSD} per person`:"Contact for pricing",[e]),k=e?.pricePerPersonUSD?Number(e.pricePerPersonUSD):null,O=k?k*(Number(d.numberOfPeople)||1):null,F=(0,s.useMemo)(()=>Array.from(new Set(N.map(e=>e.location).filter(Boolean))),[N]),A=(0,s.useMemo)(()=>Array.from(new Set(N.map(e=>e.starRating).filter(Boolean))).sort(),[N]),R=(0,s.useMemo)(()=>{if("partner_hotel"!==$)return null;let e=N.filter(e=>(!y||e.location===y)&&(!P||Number(e.starRating)===Number(P)));return e.length?e.reduce((e,t)=>Number(t.pricePerNight||0)<Number(e.pricePerNight||0)?t:e):null},[$,N,y,P]),U=R&&Number(R.pricePerNight)||0,T=U*(D||1)*(Number(d.numberOfPeople)||1),M=(Number(_)||0)*(D||1)*(Number(d.numberOfPeople)||1),q="partner_hotel"===$?T:"hospital_premium"===$?M:0,B=null!==O?O+q:null,H="partner_hotel"===$&&!!y&&!!P&&!R,I="hospital_premium"===$?"Hospital premium stay":"partner_hotel"===$?R?`${R.location}${R.starRating?` \xb7 ${R.starRating}★`:""}`:"Partner hotel":"Own arrangement";if(!t||!e)return null;let E=e=>{p(t=>{if(!t[e])return t;let r={...t};return delete r[e],r})},z=()=>{let e={};d.fullName.trim()||(e.fullName="Full name is required"),d.email.trim()?/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(d.email.trim())||(e.email="Enter a valid email"):e.email="Email is required";let t=d.phone.replace(/\D/g,"");if((!t||t.length<7)&&(e.phone="Phone must be at least 7 digits"),d.country.trim()||(e.country="Country is required"),d.preferredStartDate){let t=new Date(d.preferredStartDate),r=new Date;r.setHours(0,0,0,0),(isNaN(t.getTime())||t<r)&&(e.preferredStartDate="Choose today or a future date")}else e.preferredStartDate="Preferred start date is required";let r=Number(d.numberOfPeople);return(!r||r<1)&&(e.numberOfPeople="At least 1 person required"),"partner_hotel"!==$||(y?P?R||(e.accommodation="No partner hotel matches this selection"):e.accommodation="Choose a hotel quality":e.accommodation="Choose a location"),p(e),0===Object.keys(e).length},L=e=>{let{name:t,value:r}=e.target,a=r;"numberOfPeople"===t&&(a=Math.max(1,Number(r)||1)),E(t),c(e=>({...e,[t]:a}))},V=()=>{p({}),c(n),f(!1),g(null),v(""),w(""),S("hospital_premium"),r?.()},G=async t=>{if(t?.preventDefault(),z()){E("accommodation"),h(!0);try{let t=await fetch((0,l.f8)("/retreat-bookings"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({programId:e._id,programTitle:e.title,fullName:d.fullName,email:d.email,phone:d.phone,country:d.country,preferredStartDate:d.preferredStartDate,numberOfPeople:Number(d.numberOfPeople)||1,additionalNotes:d.additionalNotes,accommodationChoice:$,hotelMode:"partner_hotel"===$?"locationAndStar":"none",hotelLocation:"partner_hotel"===$?R?.location:void 0,hotelStarRating:"partner_hotel"===$?R?.starRating:void 0,partnerHotelId:"partner_hotel"===$?R?._id:void 0,accommodationMode:"partner_hotel"===$?"locationAndStar":$,accommodationSelected:"own_arrangement"!==$,accommodationPricePerNight:"partner_hotel"===$?U:_,accommodationNights:D||1,accommodationTotalCost:q,totalPriceUSD:B||void 0}),credentials:"include"}),r=await t.json().catch(()=>({}));if(!t.ok)throw Error((0,o.i)({data:r},"Failed to book retreat"));g(r?.data?._id||r?.bookingId||null),p({}),f(!0)}catch(e){alert(e.message||"Failed to submit booking")}finally{h(!1)}}},J=async()=>{if(b)try{let e=await (0,l.sg)("/payments/stripe/checkout",{bookingId:b,type:"retreat"});e?.url&&(window.location.href=e.url)}catch(e){alert((0,o.i)(e,"Unable to start Stripe checkout"))}},Z=e=>m[e]?`${i} border-red-400 focus:border-red-500 focus:ring-2 focus:ring-red-200 bg-white`:`${i} border-[#dfe8e2] focus:border-[#2F8D59] focus:ring-2 focus:ring-[#cfe8d6] bg-white`,K=(0,a.jsxs)("div",{className:"space-y-2 text-sm text-[#10231a]",children:[(0,a.jsxs)("div",{className:"rounded-lg bg-[#fff7ed] border border-[#f2d5b1] px-3 py-2",children:[a.jsx("p",{className:"font-semibold text-[#c2410c]",children:"Important"}),a.jsx("p",{children:"Extra charges apply for any activities or services not listed in the program description."})]}),(0,a.jsxs)("div",{className:"rounded-lg bg-[#fef2f2] border border-[#fecdd3] px-3 py-2",children:[a.jsx("p",{className:"font-semibold text-[#be123c]",children:"Refund Policy"}),a.jsx("p",{children:"After payment, booking cancellations will incur a 10% deduction of the total booking cost."})]})]});return a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-start justify-center px-4 py-10",onClick:V,children:(0,a.jsxs)("div",{className:"w-full max-w-3xl max-h-[90vh] bg-white rounded-2xl shadow-2xl border border-[#dfe8e2] p-6 md:p-8 space-y-6 overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.18em] text-[#2F8D59] font-semibold",children:"Book this retreat program"}),a.jsx("h3",{className:"text-xl font-semibold text-[#10231a]",children:e.title}),(0,a.jsxs)("div",{className:"text-sm text-[#4c5f68] space-y-0.5",children:[(0,a.jsxs)("p",{children:["Type: ","inside_valley"===e.programType?"Inside Valley":"Outside Valley"]}),e.durationDays?(0,a.jsxs)("p",{children:["Duration: ",e.durationDays," days"]}):null,(0,a.jsxs)("p",{children:["Price: ",C]})]})]}),a.jsx("button",{onClick:V,className:"text-sm text-[#2F8D59] font-semibold","aria-label":"Close booking",children:"✕"})]}),u?(0,a.jsxs)("div",{className:"space-y-4 border-t border-[#e6f0eb] pt-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[a.jsx("p",{className:"text-[#4c5f68]",children:"Retreat price / person"}),a.jsx("p",{className:"font-semibold text-[#10231a]",children:k?`$${k}`:"—"})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[a.jsx("p",{className:"text-[#4c5f68]",children:"Accommodation"}),a.jsx("p",{className:"font-semibold text-[#10231a]",children:"hospital_premium"===$?_?`$${_} / night`:"Hospital premium":"partner_hotel"===$?R?`$${R.pricePerNight} / night`:"Partner hotel":"Own arrangement"})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[a.jsx("p",{className:"text-[#4c5f68]",children:"Number of people"}),a.jsx("p",{className:"font-semibold text-[#10231a]",children:d.numberOfPeople})]}),(0,a.jsxs)("div",{className:"rounded-xl border-2 border-[#2F8D59] bg-[#e6f2ea] px-4 py-3",children:[a.jsx("p",{className:"text-[#2F8D59] font-semibold",children:"Total amount"}),a.jsx("p",{className:"text-lg font-bold text-[#10231a]",children:null!==B?`$${B}`:"—"})]})]}),(0,a.jsxs)("div",{className:"text-sm text-[#10231a] bg-white border border-[#dfe8e2] rounded-xl px-4 py-3 space-y-1",children:[(0,a.jsxs)("p",{children:["Base program cost: ",null!==O?`$${O}`:"—"]}),(0,a.jsxs)("p",{children:["Accommodation (",I,"): ",q?`$${q}`:"No extra cost"]}),(0,a.jsxs)("p",{className:"font-semibold",children:["Grand total: ",null!==B?`$${B}`:"—"]})]}),"partner_hotel"===$&&R&&(0,a.jsxs)("div",{className:"text-sm text-[#10231a] bg-[#f5f8f4] border border-[#dfe8e2] rounded-xl px-4 py-3",children:[a.jsx("p",{className:"font-semibold text-[#2F8D59]",children:"Partner hotel"}),(0,a.jsxs)("p",{children:[R.location," ",R.starRating?`\xb7 ${R.starRating}★`:""," — $",R.pricePerNight,"/night \xd7 ",D," night",1===D?"":"s"," = $",q]})]}),"hospital_premium"===$&&(0,a.jsxs)("div",{className:"text-sm text-[#10231a] bg-[#f5f8f4] border border-[#dfe8e2] rounded-xl px-4 py-3",children:[a.jsx("p",{className:"font-semibold text-[#2F8D59]",children:"Hospital premium"}),(0,a.jsxs)("p",{children:["$",_||0," / night \xd7 ",D," night",1===D?"":"s"," \xd7 ",d.numberOfPeople," people = $",M]})]}),K,(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-sm font-semibold text-[#10231a]",children:"Choose how you want to pay"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsx("button",{onClick:J,className:"flex-1 inline-flex justify-center items-center rounded-full bg-[#2F8D59] text-white text-sm font-semibold px-4 py-3 hover:bg-[#27784c] transition",children:"Pay now with Stripe"}),a.jsx("button",{onClick:()=>{alert("Booking placed successfully. Pay later to confirm."),V()},className:"flex-1 inline-flex justify-center items-center rounded-full border border-[#dfe8e2] text-[#10231a] text-sm font-semibold px-4 py-3 hover:bg-[#f5f8f4] transition",children:"Pay later"})]})]})]}):(0,a.jsxs)("form",{className:"space-y-4",onSubmit:G,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Full Name *"}),a.jsx("input",{name:"fullName",value:d.fullName,onChange:L,className:Z("fullName")}),m.fullName&&a.jsx("p",{className:"text-xs text-red-500",children:m.fullName})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Email *"}),a.jsx("input",{name:"email",type:"email",value:d.email,onChange:L,className:Z("email")}),m.email&&a.jsx("p",{className:"text-xs text-red-500",children:m.email})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Phone *"}),a.jsx("input",{name:"phone",value:d.phone,onChange:L,className:Z("phone")}),m.phone&&a.jsx("p",{className:"text-xs text-red-500",children:m.phone})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Country *"}),a.jsx("input",{name:"country",value:d.country,onChange:L,className:Z("country")}),m.country&&a.jsx("p",{className:"text-xs text-red-500",children:m.country})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Preferred Start Date *"}),a.jsx("input",{type:"date",name:"preferredStartDate",value:d.preferredStartDate,onChange:L,className:Z("preferredStartDate")}),m.preferredStartDate&&a.jsx("p",{className:"text-xs text-red-500",children:m.preferredStartDate})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Number of People *"}),a.jsx("input",{type:"number",min:1,name:"numberOfPeople",value:d.numberOfPeople,onChange:L,className:Z("numberOfPeople")}),m.numberOfPeople&&a.jsx("p",{className:"text-xs text-red-500",children:m.numberOfPeople})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-[#10231a] font-semibold",children:"Accommodation choice"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-start gap-3 rounded-xl border border-[#dfe8e2] px-4 py-3 bg-white cursor-pointer",children:[a.jsx("input",{type:"radio",name:"accommodationChoice",value:"hospital_premium",checked:"hospital_premium"===$,onChange:()=>{S("hospital_premium"),v(""),w(""),E("accommodation")},className:"mt-1"}),(0,a.jsxs)("div",{className:"text-sm text-[#10231a]",children:[a.jsx("p",{className:"font-semibold",children:"Hospital premium stay"}),a.jsx("p",{className:"text-[#4c5f68]",children:_?`$${_} / night \xd7 ${D} night${1===D?"":"s"}`:"Price not set"})]})]}),(0,a.jsxs)("label",{className:"flex items-start gap-3 rounded-xl border border-[#dfe8e2] px-4 py-3 bg-white cursor-pointer",children:[a.jsx("input",{type:"radio",name:"accommodationChoice",value:"partner_hotel",checked:"partner_hotel"===$,onChange:()=>{S("partner_hotel"),E("accommodation")},className:"mt-1"}),(0,a.jsxs)("div",{className:"text-sm text-[#10231a]",children:[a.jsx("p",{className:"font-semibold",children:"Partner hotel accommodation"}),a.jsx("p",{className:"text-[#4c5f68]",children:R?`USD ${R.pricePerNight} / night \xd7 ${D} night${1===D?"":"s"} = USD ${T}`:"Choose a partner hotel option"})]})]}),(0,a.jsxs)("label",{className:"flex items-start gap-3 rounded-xl border border-[#dfe8e2] px-4 py-3 bg-white cursor-pointer",children:[a.jsx("input",{type:"radio",name:"accommodationChoice",value:"own_arrangement",checked:"own_arrangement"===$,onChange:()=>{S("own_arrangement"),v(""),w(""),E("accommodation")},className:"mt-1"}),(0,a.jsxs)("div",{className:"text-sm text-[#10231a]",children:[a.jsx("p",{className:"font-semibold",children:"Own arrangement"}),a.jsx("p",{className:"text-[#4c5f68]",children:"No additional accommodation charges."})]})]})]}),"partner_hotel"!==$?null:(0,a.jsxs)("div",{className:"space-y-3 border border-[#dfe8e2] rounded-xl p-4 bg-[#f9fcf8]",children:[0===N.length?a.jsx("div",{className:"text-sm text-[#4c5f68] bg-white border border-[#dfe8e2] rounded-lg px-3 py-2",children:"No partner hotels available right now."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-semibold text-[#10231a]",children:"Location"}),(0,a.jsxs)("select",{value:y,onChange:e=>{E("accommodation"),v(e.target.value)},className:`${i} bg-white ${H?"border-red-400 focus:border-red-500 focus:ring-red-200":"border-[#dfe8e2]"}`,children:[a.jsx("option",{value:"",children:"Choose location"}),F.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm font-semibold text-[#10231a]",children:"Hotel quality"}),(0,a.jsxs)("select",{value:P,onChange:e=>{E("accommodation"),w(e.target.value)},className:`${i} bg-white ${H?"border-red-400 focus:border-red-500 focus:ring-red-200":"border-[#dfe8e2]"}`,children:[a.jsx("option",{value:"",children:"Choose rating"}),A.map(e=>(0,a.jsxs)("option",{value:e,children:[e," ★"]},e))]})]})]}),a.jsx("div",{className:"text-sm text-[#10231a] bg-white border border-[#dfe8e2] rounded-lg px-3 py-2 space-y-1",children:R?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:["Price per night: ",(0,a.jsxs)("span",{className:"font-semibold",children:["USD ",R.pricePerNight]})]}),(0,a.jsxs)("p",{children:["Nights: ",D," • Total: ",(0,a.jsxs)("span",{className:"font-semibold",children:["USD ",T]})]})]}):H?a.jsx("p",{className:"text-red-600",children:"No partner hotel found for the selected location and hotel category. Please choose another option."}):a.jsx("p",{className:"text-[#4c5f68]",children:"Select location and hotel quality to see pricing."})})]}),m.accommodation&&a.jsx("p",{className:"text-xs text-red-500",children:m.accommodation})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[a.jsx("p",{className:"text-[#4c5f68]",children:"Retreat price / person"}),a.jsx("p",{className:"font-semibold text-[#10231a]",children:k?`$${k}`:"—"})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[a.jsx("p",{className:"text-[#4c5f68]",children:"Accommodation"}),a.jsx("p",{className:"font-semibold text-[#10231a]",children:"hospital_premium"===$?_?`$${_} / night`:"Hospital premium":"partner_hotel"===$?R?`$${R.pricePerNight} / night`:"Partner hotel":"Own arrangement"})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-[#dfe8e2] bg-[#f5f8f4] px-4 py-3",children:[a.jsx("p",{className:"text-[#4c5f68]",children:"Duration"}),(0,a.jsxs)("p",{className:"font-semibold text-[#10231a]",children:[D," night",1===D?"":"s"]})]}),(0,a.jsxs)("div",{className:"rounded-xl border-2 border-[#2F8D59] bg-[#e6f2ea] px-4 py-3",children:[a.jsx("p",{className:"text-[#2F8D59] font-semibold",children:"Total amount"}),a.jsx("p",{className:"text-lg font-bold text-[#10231a]",children:null!==B?`$${B}`:"—"})]})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("label",{className:"text-sm text-[#10231a] font-semibold",children:"Additional Notes"}),a.jsx("textarea",{name:"additionalNotes",rows:3,value:d.additionalNotes,onChange:L,className:`${i} border-[#dfe8e2] focus:border-[#2F8D59] focus:ring-2 focus:ring-[#cfe8d6] bg-white resize-none`,placeholder:"Share any preferences or needs"})]}),K,(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[a.jsx("button",{type:"button",onClick:V,className:"px-4 py-2 rounded-full border border-[#dfe8e2] text-[#10231a] hover:bg-[#f5f8f4] transition",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:x||H,className:"px-5 py-2 rounded-full bg-[#2F8D59] text-white text-sm font-semibold hover:bg-[#27784c] transition disabled:opacity-60",children:x?"Booking...":"Book Retreat"})]})]})]})})}},6168:(e,t,r)=>{r.d(t,{i:()=>a});function a(e,t="Something went wrong"){if(!e)return t;let r=e.response?.data||e.data;if(r?.errors&&"object"==typeof r.errors){let e=Object.values(r.errors).flatMap(e=>Array.isArray(e?._errors)?e._errors:[]).filter(Boolean);if(e.length)return e.join(", ")}return r?.message?r.message:"string"==typeof e?e:e.message?e.message:t}}};